timeutils
=========

GNU touch コマンドを MinGW でビルドして Windows で動くようにする予定です。まだ開発途中ですが、少しずつソースを公開していきます。これらをビルドするには Windows 上に Cygwin 1.7.35 以降と gcc、mingw64-i686 等の開発用パッケージが必要になります。

2025-W46 現在、関数のテスト用に作成した adjustday、currentft、getft、leapdays、localtime、mktime、modifysec コマンドが使えます。localtime と mktime は同名の POSIX 関数を自作しました。関数内では `#define` で Cygwin と MSVCRT（msvcrt.dll）の関数をラップした部分を分けてあります。それぞれ、`make cygwin`、`make msvcrt` で cygwin、msvcrt ディレクトリ配下にコマンドが作成され、同じ引数を使って動作の違いを確かめられます。

#### adjustday

コマンドの引数に年、月、日（負の値も可能）を指定すると、月と日を正しい範囲に修正して結果を表示します。Cygwin と MSVCRT にはこのコマンドがありません。

#### currentft

現在の時刻を 1601-01-01 00:00 UTC からの 100 ナノ秒、または、1970-01-01 00:00 UTC からの秒で表示します。MSVCRT にはこのコマンドがありません。

#### getft

コマンドの引数に指定したファイルの時刻を 1601-01-01 00:00 UTC からの 100 ナノ秒、または、1970-01-01 00:00 UTC からの秒で表示します。MSVCRT にはこのコマンドがありません。

#### leapdays

コマンドの引数に２つの年（負の値も可能）を指定すると、その期間に含まれるうるう日の数を表示します。`-t` オプションを指定すると、400 で割り切れる年数、残りの 4 で割り切れる年数、4 年未満の各集計テーブルを表示します。Cygwin と MSVCRT にはこのコマンドがありません。

#### localtime

コマンドの引数に 1970-01-01 00:00 UTC からの秒を指定（小数部分も可能）すると、ローカル時刻に変換して年、月、日、時、分、秒を表示します。MSVCRT のコマンドは - UTC オフセットより小さい秒を指定できません。

#### mktime

[mktime コマンド](./mktime.md) を参照。

#### modifysec

コマンドの引数に指定した 1970-01-01 00:00 UTC からの秒や小数部分の 100 ナノ秒を変更した値を表示します。`-C` や `-F` オプションを指定すると、秒の値を（小数部分にゼロを設定して）切り上げたり、切り下げたりします。また、`-R` や `-P` オプションを指定すると、小数部分にランダムな値を設定したり、 桁を並べ替えたりします。MSVCRT にはこのコマンドがありません。

日付や時刻を表示するコマンドでは曜日名、週番号、年内日数、UTC からのオフセットを表示したり、元号、ISO 8601 の形式で表示したりすることができます。詳しくは `--help` を付けてコマンドを実行してください。

コマンドの最初の引数に負の値を指定する場合、引数の前に `--` を指定する必要があります。

## ライセンス

このプログラムは GPL v2.0 で公開されています。
